name: Test adding label to pr

concurrency:
  group: ${{ github.workflow }}-${{ github.event.workflow_run.id }}
  cancel-in-progress: true

on:
  workflow_run:
    workflows: ["Build PR From Fork"]
    types: ["completed"]
    branches-ignore: ["main"]

jobs:
  prepare_jobs:
    runs-on: ubuntu-latest
    outputs:
      pr_number: '${{ steps.get_pr_number.outputs.pr_number }}'
    steps:
      - uses: 8BitJonny/gh-get-current-pr@2.1.1
        id: PR
      - run: echo "Your PR number is ${{ steps.PR.outputs.number }} and its JSON is ${{ steps.PR.outputs.pr }}"
          
      - name: Get PR number
        shell: sh
        run:  echo "${{ steps.PR.outputs.number }}"
          
      - name: Get PR number
        shell: sh
        id: get_pr_number
        run: |
          echo "::set-output name=pr_number::${{ steps.PR.outputs.number }}"
  notify_failure:
    runs-on: ubuntu-latest
    needs: ["prepare_jobs"]
    env:
      PR_NUMBER: ${{ needs.prepare_jobs.outputs.pr_number }}
    steps:
      - uses: actions/checkout@a12a3943b4bdde767164f792f33f40b04645d846 # v3.0.0
      - name: Get PR number
        shell: sh
        run: |
          echo "${{ env.PR_NUMBER }}"
      - name: Label
        uses: ./.github/actions/fork-result-label
        continue-on-error: true
        with:
          SUCCESS: 'false'
          PULL_REQUEST_NUMBER: ${{ env.PR_NUMBER }}

  notify_success:
    runs-on: ubuntu-latest
    needs: ["prepare_jobs"]
    env:
      PR_NUMBER: ${{ needs.prepare_jobs.outputs.pr_number }}
    steps:
      - uses: actions/checkout@a12a3943b4bdde767164f792f33f40b04645d846 # v3.0.0
      - name: Get PR number
        shell: sh
        run: |
          echo "${{ env.PR_NUMBER }}"
      - name: Label
        uses: ./.github/actions/fork-result-label
        continue-on-error: true
        with:
          SUCCESS: 'true'
          PULL_REQUEST_NUMBER: ${{ env.PR_NUMBER }}
